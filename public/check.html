<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Gogram Session Checker</title>

<style>
  * {
    box-sizing: border-box;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  }

  body {
    background: #0f1115;
    color: #e5e7eb;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
  }

  .card {
    width: 420px;
    background: #151823;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,.4);
  }

  h1 {
    font-size: 18px;
    margin-bottom: 12px;
    text-align: center;
  }

  textarea, input {
    width: 100%;
    background: #0f1320;
    border: 1px solid #2a2f45;
    color: #e5e7eb;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 10px;
    font-size: 14px;
  }

  textarea {
    resize: vertical;
    min-height: 90px;
  }

  button {
    width: 100%;
    padding: 10px;
    border: none;
    border-radius: 8px;
    background: #4f46e5;
    color: white;
    font-size: 15px;
    cursor: pointer;
  }

  button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  .result {
    margin-top: 12px;
    padding: 10px;
    border-radius: 8px;
    font-size: 14px;
    display: none;
  }

  .success {
    background: #052e1a;
    color: #6ee7b7;
  }

  .error {
    background: #2e0505;
    color: #fca5a5;
  }

  .row {
    display: flex;
    gap: 8px;
  }

  .row input {
    flex: 1;
  }

  .small {
    opacity: .6;
    font-size: 12px;
    text-align: center;
    margin-top: 8px;
  }
</style>
</head>

<body>

<div class="card">
  <h1>Gogram Session Checker</h1>

  <textarea id="session" placeholder="Paste session string here"></textarea>

  <div class="row">
    <input id="appId" placeholder="App ID (optional)" />
    <input id="appHash" placeholder="App Hash (optional)" />
  </div>

  <button id="checkBtn">Check Session</button>

  <div id="result" class="result"></div>

  <div class="small">Runs fully in browser (WASM)</div>
</div>

<script src="wasm_exec.js"></script>
<script>
  const go = new Go();
  let wasmReady = false;

  WebAssembly.instantiateStreaming(fetch("check.wasm"), go.importObject)
    .then(res => {
      go.run(res.instance);
      wasmReady = true;
      console.log("WASM loaded");
    })
    .catch(err => {
      console.error("WASM load failed:", err);
    });

  const btn = document.getElementById("checkBtn");
  const resultBox = document.getElementById("result");

  btn.onclick = () => {
    if (!wasmReady) return alert("WASM not ready");

    const session = document.getElementById("session").value.trim();
    const appId = document.getElementById("appId").value.trim();
    const appHash = document.getElementById("appHash").value.trim();

    if (!session) {
      showError("Session string required");
      return;
    }

    btn.disabled = true;
    showInfo("Checking session...");

    try {
      if (appId || appHash) {
        checkSession(session, appId || undefined, appHash || undefined);
      } else {
        checkSession(session);
      }
    } catch (e) {
      showError(e.toString());
      btn.disabled = false;
    }
  };

  window.onSessionChecked = (res) => {
    btn.disabled = false;

    if (!res.success) {
      showError(res.error || "Invalid session");
      return;
    }

    showSuccess(
      `Valid session\n\n` +
      `Name: ${res.fullName}\n` +
      `Username: ${res.username || "-"}\n` +
      `ID: ${res.id}\n` +
      `Bot: ${res.isBot}`
    );
  };

  function showSuccess(text) {
    resultBox.className = "result success";
    resultBox.style.display = "block";
    resultBox.textContent = text;
  }

  function showError(text) {
    resultBox.className = "result error";
    resultBox.style.display = "block";
    resultBox.textContent = text;
  }

  function showInfo(text) {
    resultBox.className = "result";
    resultBox.style.display = "block";
    resultBox.textContent = text;
  }
</script>

</body>
</html>
